---
title: QSys Printing
---

`ASNA.DataGate.Common.Printfile` or `DataGate Printfile` (for short), is the ASNA.QSys class that abstracts the concept of a [IBM i Printer file](https://www.ibm.com/support/knowledgecenter/en/ssw_ibm_i_73/rzalu/rzaluprtfover.htm).

Similarly to a [QSys DatabaseFile](/concepts/program-structure/qsys-databasefile), a `DataGate Printfile` is a class used to instance objects to produce output records, according to external definitions.

## External Definition of a .NET Printfile
.NET Printfiles are output data definition records stored as a database objects.

> .NET Printfiles database objects as [Blobs](https://en.wikipedia.org/wiki/Binary_large_object) that contain the [XML](https://en.wikipedia.org/wiki/XML) detailed schema definition of the file. Such schema may be exported to a file for inspection.

## Creating/Designing `DataGate Printfile` objects
Microsoft Visual Studio (with DataGate integration) is used to create and maintain .NET Printfiles.

## Using PrintFiles in a QSys Program.
To access Printfiles in a `QSys Program`, objects of the [QSys.Printfile] class are used. 
Programs typically declare the object as a member of the Program with code like:

**Declaration**
```cs
namespace MyCompany.MyApplication
{
    [ASNA.QSys.HostServices.ActivationGroup("*DFTACTGRP")]
    [ProgramEntry("_ENTRY")]
    public partial class MyProgram : ASNA.QSys.HostServices.Program
    {
        PrintFile QPRINT;
```

**Printfile Object Instantiation**

The declaration of the printfile as indicated above, has the PrintFile object set to null. As we have described in the topic [QSys DatabaseFile](/concepts/program-structure/qsys-databasefile), the .NET Printfile object is *Instanced* in the [RPG language support](/concepts/program-structure/rpg-language-support) Nomad generated method `_instanceInit`, as follows: 

```cs
void _instanceInit()
{
    .
    .
    .
    QPRINT = new PrintFile(PopulateBufferQPRINT, "QPRINT", "MYLIBRARY\\MYFILEOBJ", QPRINTFormatIDs);
}
```
The `PrintFile` class constructor has the following required parameters:

| **Parameter**            | **Description**
| populateBufferMethod     | method called internally by I/O operations when writing.
| dclPrintFileName         | *string* logical name (usually short name).
| filePath                 | *string* library and name path to database location.
| levelCheck               | *dictionary* Level Check hash codes.

The first parameter is the name of the method generated by [Nomad Tool](/concepts/enhancements/nomad-tools). As explained in the Topic [QSys DatabaseFile](/concepts/program-structure/qsys-databasefile), each time code in the `Program` writes to a record, the `PopulateBuffer` partial class generated *I/O* method wil be called, to prepare the internal buffer such that the *DataSet* can be loaded to effect the external Printfile.

The second parameter `dclPrintFileName` is a short name logically representing the external printfile name. This string identifier may be used later to form paths (for output file spooling).

The third parameter `filePath` is s string *library* and *name* path to where the printfile is defined externally in the database. 

The last required parameter is a [.NET Dictionary](https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2?view=net-5.0) with the [hash](https://en.wikipedia.org/wiki/Hash_function) codes have been loaded to be used while [Detecting File Description changes](https://www.ibm.com/support/knowledgecenter/en/ssw_ibm_i_73/dm/rbal3detectdesc.htm). This codes are also *generated* by [Nomad Tool](/concepts/enhancements/nomad-tools).

>Note the *naming convention* use by Nomad tools, the Printfile member is used while naming the partial I/O names. In this example, `QPRINT` is used in the names: PopulateBufferQPRINT and QPRINTFormatIDs

 **Program Constructor Code**

Before a .NET Printfile can be opened for writing, there are a few required properties that need to be setup.

Let's look at the typical code that goes into every `QSys Program`'s constructor (related to printfiles):

```cs
public MyProgram()
{
    .
    .
    .
    QPRINT.Printer = "Microsoft Print to PDF";
    QPRINT.Overrider = Job;
    QPRINT.ManuscriptPath = ASNA.QSys.HostServices.Program.Spooler.GetNewFilePath(QPRINT.DclPrintFileName);
    QPRINT.Open(Job.PrinterDB);
}
```

The `Printer` property should have the name of the [Printer Driver](https://en.wikipedia.org/wiki/Printer_driver) existing in the server where the Application will be deployed.

> During development be aware that when the Application is deployed the available Print Drivers may be different in the deployment server.

The `Overrider` property should have the instance of the running [QSys Job](/concepts/architecture/qsys-job).

> Pay attention to the method `getPrinterDB` in `MyJob.cs`. It should return the instance of the DataGate Database Name where the .NET Printfile definitions exist. [See QSys Architecture](/concepts/architecture/qsys-job)

The `ManuscriptPath` is a string with the Operating System's path to the folder structure used for Program Spooling.

Finally, the .NET Printfile is **opened** in the Program's constructor. The Printfile object instantiation should have been done properly and the Printfile object's required properties should have the right values. Opening means to find the external description and prepare the Printfile to be written to.

**Destructor**

The Program *Destructor* is implemented in the method **Dispose** that gets called during [.NET Garbage Collection](https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)). When a Program is *Deactivated*, it is marked as *disposable* to the .NET garbage collector. When memory needs to be reclaimed, the `Dispose` method will be called.

```cs
override public void Dispose(bool disposing)
{
    if (disposing)
    {
        .
        .
        .        
        QPRINT.Close();
    }
    base.Dispose(disposing);
}
```

Closing a Printfile does not take any parameters. It it als safe to `Close` a Printfile that was already closed (or never opened). When using a [PDF](https://en.wikipedia.org/wiki/PDF) Print Driver, the `Closing` of the Printfile will trigger I/O events, such as flushing contents, and completing creating the **PDF** file. (There may be other events triggered associated with File Spooling).


**Writing records**

Writing is no different that any other file (like [WorkstationFile](/reference/qsys-worstationfile) or [DatabaseFile](/reference/qsys-printfile) ), the Program implements logic that:
1. Sets values to the fields defined in the .NET Printfile records.
2. The method `Write` is called.

For example, the code:

```cs
wCUSTNO = EditCode.Apply(pCUSTNO, 0, 9, EditCodes.Z, "").Trim() + " " + CMNAME;
wORDNBR = EditCode.Apply(pORDNBR, 0, 9, EditCodes.Z, "").Trim();
QPRINT.Write("PrtNmeLine", _IN.Array);
```

Sets the .NET Printfile fields `wCUSTNO` and `wORDNBR` defined in record format `PrtNmeLine`. Notice how fields in .NET Printfiles are also [Fixed Types](/concepts/program-structure/qsys-fixedtypes) as defined by Legacy DDS which may need formatting according to [Edit codes in printer files](https://www.ibm.com/support/knowledgecenter/ssw_ibm_i_71/rzakd/os400edits.htm).

> QSys Fixed Types do automatic conversion from/to C# *string* types.

Writing to the .NET Printfile requires the [Indicators](/concepts/program-structure/qsys-program). This is needed to evaluate conditional writing of fields in the printfile.

**Checking for Page Overflow**

.NET Printfile design defines the *Overflow* page area. This is the area from the bottom of the Page where no printing should happen. 

Generated QSys derived Application Programs define a member field called:

```cs
Indicator _INOF;
```

This is the Page *Overflow Indicator*. The Application Program needs to update the state of this *Indicator* after every `Write` operation to any of the Printfiles.

Code generation is very consistent, after a `Write` method call, there will always be the following property setter:

```cs
QPRINT.Write("MyRecordName", _IN.Array);
_INOF = (Indicator)QPRINT.InOverflow;
```

To update `_INOF`, the current value of the Printfile indicator is read. The property `InOverflow` of the PrintFile object returns if the *next* print line will fall into the non-printable area of the page.

> When adding code manually, don't forget to update the `_INOF` indicator.


